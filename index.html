<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS Chess - No Backend Needed</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <style>
        .square { width: 12.5%; aspect-ratio: 1/1; display: flex; align-items: center; justify-content: center; font-size: clamp(1rem, 5vw, 2.5rem); cursor: pointer; }
        .white-sq { background-color: #f0d9b5; color: #b58863; }
        .black-sq { background-color: #b58863; color: #f0d9b5; }
        .selected { background-color: #7b61ff !important; color: white !important; }
        .last-move { background-color: #f6f669cc !important; }
        .piece-white { color: #ffffff; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.4)); }
        .piece-black { color: #111111; }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen flex items-center justify-center p-4">

    <div class="max-w-5xl w-full flex flex-col md:flex-row gap-8">
        <div class="flex-1 flex flex-col items-center bg-slate-900 p-6 rounded-3xl border border-slate-800 shadow-2xl">
            <h1 class="text-2xl font-black mb-6 tracking-tighter text-cyan-400">PURE JS CHESS</h1>
            
            <div id="board" class="w-full max-w-[512px] flex flex-wrap border-4 border-slate-800 rounded shadow-2xl">
                </div>

            <div class="w-full max-w-[512px] mt-8 flex justify-between items-center bg-slate-800/50 p-4 rounded-xl">
                <div id="status" class="font-bold uppercase tracking-widest text-xs text-emerald-400">White's Turn</div>
                <button onclick="resetGame()" class="bg-rose-600 hover:bg-rose-500 px-6 py-2 rounded-lg font-bold transition-transform active:scale-95 text-xs uppercase">
                    Reset
                </button>
            </div>
        </div>

        <div class="w-full md:w-72 bg-slate-900 p-6 rounded-3xl border border-slate-800 shadow-2xl flex flex-col h-[512px]">
            <h2 class="font-bold text-slate-400 mb-4 flex items-center uppercase text-xs tracking-widest">
                History
            </h2>
            <div id="history" class="flex-grow overflow-y-auto space-y-2 pr-2"></div>
        </div>
    </div>

    <script>
        const game = new Chess();
        const boardEl = document.getElementById('board');
        let selectedSq = null;

        const faMap = {
            'r': 'fa-chess-rook', 'n': 'fa-chess-knight', 'b': 'fa-chess-bishop',
            'q': 'fa-chess-queen', 'k': 'fa-chess-king', 'p': 'fa-chess-pawn'
        };

        function renderBoard() {
            boardEl.innerHTML = '';
            const history = game.history({ verbose: true });
            const lastMove = history.length > 0 ? history[history.length - 1] : null;

            // chess.js SQUARES go from a8 to h1
            for (let r = 0; r < 8; r++) {
                for (let c = 0; c < 8; c++) {
                    const squareLabel = String.fromCharCode(97 + c) + (8 - r);
                    const piece = game.get(squareLabel);
                    const div = document.createElement('div');
                    
                    const isDark = (r + c) % 2 !== 0;
                    div.className = `square ${isDark ? 'black-sq' : 'white-sq'}`;
                    
                    if (selectedSq === squareLabel) div.classList.add('selected');
                    if (lastMove && (squareLabel === lastMove.from || squareLabel === lastMove.to)) {
                        div.classList.add('last-move');
                    }

                    if (piece) {
                        const icon = faMap[piece.type];
                        const colorClass = piece.color === 'w' ? 'piece-white' : 'piece-black';
                        div.innerHTML = `<i class="fas ${icon} ${colorClass}"></i>`;
                    }

                    div.onclick = () => handleSquareClick(squareLabel);
                    boardEl.appendChild(div);
                }
            }
            updateUI();
        }

        function handleSquareClick(square) {
            if (game.game_over()) return;

            if (selectedSq === null) {
                const piece = game.get(square);
                if (piece && piece.color === game.turn()) {
                    selectedSq = square;
                }
            } else {
                const move = game.move({
                    from: selectedSq,
                    to: square,
                    promotion: 'q' // Always promote to queen for simplicity
                });

                selectedSq = null;
                if (move === null) {
                    // Flash red or similar for illegal move
                } else {
                    // If you want a random AI to play black:
                    if (!game.game_over() && game.turn() === 'b') {
                        setTimeout(makeRandomMove, 500);
                    }
                }
            }
            renderBoard();
        }

        function makeRandomMove() {
            const moves = game.moves();
            if (moves.length === 0) return;
            const randomIdx = Math.floor(Math.random() * moves.length);
            game.move(moves[randomIdx]);
            renderBoard();
        }

        function updateUI() {
            const status = document.getElementById('status');
            const historyDiv = document.getElementById('history');
            
            // Status
            if (game.in_checkmate()) status.innerText = "Checkmate!";
            else if (game.in_draw()) status.innerText = "Draw";
            else status.innerText = game.turn() === 'w' ? "White's Turn" : "Black's Turn";

            // History
            const moves = game.history();
            historyDiv.innerHTML = '';
            for (let i = 0; i < moves.length; i += 2) {
                historyDiv.innerHTML += `
                    <div class="flex text-sm border-b border-slate-800 pb-1">
                        <span class="w-8 text-slate-600">${Math.floor(i/2)+1}.</span>
                        <span class="flex-1 font-bold text-cyan-400">${moves[i]}</span>
                        <span class="flex-1 font-bold text-orange-400">${moves[i+1] || ''}</span>
                    </div>`;
            }
            historyDiv.scrollTop = historyDiv.scrollHeight;
        }

        function resetGame() {
            game.reset();
            selectedSq = null;
            renderBoard();
        }

        renderBoard();
    </script>
</body>
</html>